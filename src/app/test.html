<!DOCTYPE html>
<html>
	<head>
		<title>AirBnB locations Montauban</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
		<script src="export82.js"></script>
		<script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
		<style>
			#map{
				width:900px;
				height:500px;
				border: solid 1px;
			}
		</style>

	</head>

	<body>

		<!-- div de la map -->
		<div id="map"></div>
		<input type="button" value="Locate me!" onClick="javascript:getLocationLeaflet();">
		</br>
		<a href="">Télécharger les données en format csv</a>

		<script language="javascript">
			var Albi = [43.933333, 2.150000]

			//CARTE

			//var carte = L.map('map').setView([42.3630104, 2.9846608], 8);
			var map = L.map('map').setView(Albi, 12);
			L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
				maxZoom: 18
         	}).addTo(map);
			map.attributionControl.setPrefix(''); // Don't show the 'Powered by Leaflet' text.

			//GEOLOCATION

			function onLocationFound(e) {
				var radius = e.accuracy / 2;
				var location = e.latlng
				L.marker(location).addTo(map)
				L.circle(location, radius).addTo(map);
			}

			function onLocationError(e) {
				alert(e.message);
			}

			function getLocationLeaflet() {
				map.on('locationfound', onLocationFound);
				map.on('locationerror', onLocationError);

				map.locate({setView: true, maxZoom: 15});

			}
			//MARKERS

			map.on('click', placerMarqueur);

			function placerMarqueur(e) {
				var lati = e.latlng.lat;
				var longi = e.latlng.lng;
				console.log(lati);
				console.log(longi);
				var marker = L.marker([lati,longi]);
				marker.addTo(map);
				marker.bindPopup();
				// Faire quelque chose suite à l’événement
				
			}

			console.log(markers);
			//console.log(markers.length);
			function loadMarkers(){
				n=markers.length;
				console.log(n);
				for(i=0 ; i<n ; i++){
					var link = "http://airbnb.com/rooms/"+markers.indexOf(i).id;
					console.log(link);
				}
				
			}


			loadMarkers();

		</script>
	</body>
</html>
